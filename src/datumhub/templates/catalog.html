{% extends "base.html" %}
{% block title %}DatumHub — Open Data Catalog{% endblock %}

{% block extra_css %}
.hero {
  text-align: center;
  margin-bottom: 2.5rem;
}
.hero h1 {
  font-size: 2rem;
  font-weight: 700;
  margin: 0 0 0.4rem;
  letter-spacing: -0.03em;
  color: #0f172a;
}
.hero p {
  color: #64748b;
  margin: 0 0 1.5rem;
  font-size: 1rem;
}
.search-form {
  display: flex;
  gap: 0.5rem;
  max-width: 460px;
  margin: 0 auto;
}
.search-input {
  flex: 1;
  padding: 0.5rem 0.875rem;
  border: 1px solid #cbd5e1;
  border-radius: 0.375rem;
  font-size: 0.9375rem;
  background: #fff;
  outline: none;
  color: #1e293b;
}
.search-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px #bfdbfe66; }
.search-btn {
  padding: 0.5rem 1.125rem;
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 0.375rem;
  font-size: 0.9375rem;
  cursor: pointer;
  font-weight: 500;
}
.search-btn:hover { background: #1d4ed8; }

.section-label {
  font-size: 0.8125rem;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 1rem;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
}

.card {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 0.625rem;
  padding: 1.25rem;
  text-decoration: none;
  color: inherit;
  display: block;
  transition: border-color 0.15s, box-shadow 0.15s, transform 0.1s;
}
.card:hover {
  border-color: #93c5fd;
  box-shadow: 0 4px 12px rgba(59,130,246,0.08);
  transform: translateY(-1px);
  text-decoration: none;
}

.card-id {
  font-family: 'SF Mono', 'Monaco', monospace;
  font-size: 0.75rem;
  color: #2563eb;
  margin: 0 0 0.5rem;
}
.card-title {
  font-size: 0.9375rem;
  font-weight: 600;
  margin: 0 0 0.375rem;
  color: #0f172a;
}
.card-desc {
  font-size: 0.8125rem;
  color: #64748b;
  margin: 0 0 0.75rem;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-height: 1.5;
}
.card-footer {
  display: flex;
  align-items: center;
  gap: 0.625rem;
  flex-wrap: wrap;
}
.card-meta {
  font-size: 0.75rem;
  color: #94a3b8;
  display: flex;
  gap: 0.625rem;
}
.card-meta span { display: flex; align-items: center; gap: 0.2rem; }
.tag-list { display: flex; gap: 0.3rem; flex-wrap: wrap; margin-top: 0.625rem; }

.empty {
  text-align: center;
  padding: 5rem 0;
  color: #94a3b8;
}
.empty p { margin: 0.375rem 0; }
.empty .snippet { max-width: 560px; margin: 1.5rem auto 0; text-align: left; }
{% endblock %}

{% block content %}
{% if not_found %}
<div style="background:#fef2f2; border:1px solid #fecaca; border-radius:0.5rem; padding:0.75rem 1rem; margin-bottom:1.5rem; font-size:0.875rem; color:#b91c1c;">
  Dataset <code>{{ not_found }}</code> not found.
</div>
{% endif %}

<div class="hero">
  <h1>Open Data Catalog</h1>
  <p>
    {% if q %}
      {{ total }} result{{ 's' if total != 1 else '' }} for &ldquo;<strong>{{ q }}</strong>&rdquo;
    {% else %}
      {{ total }} dataset{{ 's' if total != 1 else '' }} published
    {% endif %}
  </p>
  <form class="search-form" action="/" method="get">
    <input class="search-input" type="text" name="q" value="{{ q }}"
           placeholder="Search datasets, publishers, tags…" autofocus>
    <button class="search-btn" type="submit">Search</button>
  </form>
</div>

{% if packages %}
  {% if q %}
  <div class="section-label">Search results</div>
  {% endif %}
  <div class="grid">
    {% for pkg in packages %}
    <a class="card" href="/{{ pkg.id }}">
      <div class="card-id">{{ pkg.id }}</div>
      <div class="card-title">{{ pkg.title }}</div>
      {% if pkg.description %}
      <div class="card-desc">{{ pkg.description }}</div>
      {% endif %}
      <div class="card-meta">
        <span>{{ pkg.publisher.name }}</span>
        <span>·</span>
        <span>v{{ pkg.version }}</span>
        <span>·</span>
        <span>{{ pkg.sources | length }} source{{ 's' if pkg.sources | length != 1 else '' }}</span>
      </div>
      {% if pkg.tags %}
      <div class="tag-list">
        {% for tag in pkg.tags[:4] %}
        <span class="badge">{{ tag }}</span>
        {% endfor %}
      </div>
      {% endif %}
    </a>
    {% endfor %}
  </div>

{% elif q %}
  <div class="empty">
    <p>No datasets found for <strong>{{ q }}</strong></p>
    <p><a href="/">Browse all datasets &rarr;</a></p>
  </div>

{% else %}
  <div class="empty">
    <p style="font-size:1.125rem; font-weight:600; color:#475569;">No datasets yet.</p>
    <p>Be the first to publish one:</p>
    <div class="snippet"><span class="cmd-prefix">$</span> datum add <span class="cmd-val">https://example.com/data.csv</span>  <span class="cmd-flag">--id</span> you/your-namespace/dataset  <span class="cmd-flag">--title</span> <span class="cmd-val">"My Dataset"</span>  <span class="cmd-flag">--publisher</span> <span class="cmd-val">"Your Name"</span>  <span class="cmd-flag">--version</span> <span class="cmd-val">1.0.0</span>
<span class="cmd-prefix">$</span> datum publish  <span class="cmd-flag">--registry</span> <span class="cmd-val">https://datumhub.fly.dev</span></div>
  </div>
{% endif %}
{% endblock %}
