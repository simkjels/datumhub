{% extends "base.html" %}
{% block title %}{{ pkg.title }} — DatumHub{% endblock %}

{% block extra_css %}
.back { font-size: 0.875rem; color: #64748b; margin-bottom: 2rem; display: inline-flex; align-items: center; gap: 0.3rem; }
.back:hover { color: #3b82f6; text-decoration: none; }

.ds-header { margin-bottom: 2rem; }
.ds-id {
  font-family: 'SF Mono', 'Monaco', monospace;
  font-size: 0.8125rem;
  color: #2563eb;
  margin-bottom: 0.5rem;
}
.ds-title {
  font-size: 1.75rem;
  font-weight: 700;
  letter-spacing: -0.03em;
  color: #0f172a;
  margin: 0 0 0.75rem;
}
.ds-desc {
  color: #475569;
  font-size: 0.9375rem;
  line-height: 1.65;
  margin-bottom: 1.25rem;
}
.ds-meta-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  font-size: 0.875rem;
  color: #64748b;
  margin-bottom: 1rem;
}
.ds-meta-row span strong { color: #1e293b; }

.tag-list { display: flex; gap: 0.3rem; flex-wrap: wrap; margin-bottom: 1.5rem; }

.section-title {
  font-size: 0.9375rem;
  font-weight: 600;
  color: #0f172a;
  margin: 2rem 0 0.875rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #e2e8f0;
}

.pull-block {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 0.625rem;
  padding: 1.25rem;
  margin-bottom: 0.5rem;
}
.pull-label { font-size: 0.75rem; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }

table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
th {
  text-align: left;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #64748b;
  padding: 0.5rem 0.75rem;
  border-bottom: 1px solid #e2e8f0;
  background: #f8fafc;
}
td {
  padding: 0.75rem;
  border-bottom: 1px solid #f1f5f9;
  color: #334155;
  vertical-align: top;
}
tr:last-child td { border-bottom: none; }
td.url-cell {
  font-family: 'SF Mono', 'Monaco', monospace;
  font-size: 0.75rem;
  word-break: break-all;
  max-width: 380px;
}
td.checksum-cell {
  font-family: 'SF Mono', 'Monaco', monospace;
  font-size: 0.6875rem;
  color: #64748b;
  word-break: break-all;
  max-width: 260px;
}

.table-wrap {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 0.625rem;
  overflow: hidden;
  overflow-x: auto;
}

.version-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
.version-chip {
  background: #f1f5f9;
  color: #475569;
  font-size: 0.8125rem;
  font-family: 'SF Mono', 'Monaco', monospace;
  padding: 0.25rem 0.75rem;
  border-radius: 0.375rem;
  border: 1px solid #e2e8f0;
}
.version-chip.current {
  background: #eff6ff;
  color: #2563eb;
  border-color: #bfdbfe;
  font-weight: 600;
}
{% endblock %}

{% block content %}
<a class="back" href="/">&larr; Browse all datasets</a>

<div class="ds-header">
  <div class="ds-id">{{ pkg.id }}</div>
  <h1 class="ds-title">{{ pkg.title }}</h1>
  {% if pkg.description %}
  <p class="ds-desc">{{ pkg.description }}</p>
  {% endif %}

  <div class="ds-meta-row">
    <span><strong>Publisher</strong>
      {% if pkg.publisher.url %}
        <a href="{{ pkg.publisher.url }}" target="_blank">{{ pkg.publisher.name }}</a>
      {% else %}
        {{ pkg.publisher.name }}
      {% endif %}
    </span>
    <span><strong>Version</strong> {{ pkg.version }}</span>
    {% if pkg.license %}
    <span><strong>License</strong> {{ pkg.license }}</span>
    {% endif %}
    <span><strong>Published by</strong> {{ pkg.owner }}</span>
    <span><strong>Updated</strong> {{ pkg.published_at[:10] }}</span>
  </div>

  {% if pkg.tags %}
  <div class="tag-list">
    {% for tag in pkg.tags %}
    <span class="badge">{{ tag }}</span>
    {% endfor %}
  </div>
  {% endif %}
</div>

{# Pull snippet #}
<div class="section-title">Download</div>
<div class="pull-block">
  <div class="pull-label">datum CLI</div>
  <div class="snippet"><span class="cmd-prefix">$</span> datum pull <span class="cmd-val">{{ pkg.id }}:{{ pkg.version }}</span> <span class="cmd-flag">--registry</span> <span class="cmd-val">https://datumhub.org</span></div>
</div>

{# Sources table #}
<div class="section-title">Data sources ({{ pkg.sources | length }})</div>
<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>URL</th>
        <th>Format</th>
        <th>Size</th>
        <th>Checksum</th>
      </tr>
    </thead>
    <tbody>
      {% for src in pkg.sources %}
      <tr>
        <td class="url-cell"><a href="{{ src.url }}" target="_blank" rel="noopener">{{ src.url }}</a></td>
        <td><span class="badge">{{ src.format }}</span></td>
        <td>{% if src.size %}{{ fmt_size(src.size) }}{% else %}—{% endif %}</td>
        <td class="checksum-cell">{% if src.checksum %}{{ src.checksum }}{% else %}—{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{# Version history #}
{% if versions | length > 1 %}
<div class="section-title">Version history</div>
<div class="version-list">
  {% for v in versions %}
  <span class="version-chip {% if loop.first %}current{% endif %}">
    v{{ v.version }}{% if loop.first %} (latest){% endif %}
  </span>
  {% endfor %}
</div>
{% endif %}

{% endblock %}
